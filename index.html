<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#4A90E2">
    <title>Inventory Management</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="images/icons/icon-192x192.png">
</head>
<body>
    <div class="app-container">
        <header id="app-header" style="display: none;">
            <div class="header-content">
                <h1>Inventory Manager</h1>
                <div class="user-info">
                    <span id="current-user-name"></span>
                    <span id="current-user-role" class="user-role"></span>
                    <button id="logout-btn" class="logout-button">Logout</button>
                </div>
            </div>
        </header>

        <!-- Login Screen -->
        <div id="login-screen">
            <!-- Login content will be loaded here -->
        </div>

        <main id="main-content" style="display: none;">
            <!-- Content will be loaded here based on tab selection -->
        </main>

        <nav class="tab-navigation" id="tab-navigation" style="display: none;">
            <button id="dashboard-tab" class="tab-button active" data-tab="dashboard">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </button>
            <button id="products-tab" class="tab-button" data-tab="products">
                <i class="fas fa-box"></i>
                <span>Products</span>
            </button>
            <button id="drivers-tab" class="tab-button" data-tab="drivers">
                <i class="fas fa-user"></i>
                <span>Drivers</span>
            </button>
            <button id="assign-tab" class="tab-button" data-tab="assign">
                <i class="fas fa-truck-loading"></i>
                <span>Assign</span>
            </button>
            <button id="orders-tab" class="tab-button" data-tab="orders">
                <i class="fas fa-clipboard-list"></i>
                <span>Orders</span>
            </button>
            <button id="my-orders-tab" class="tab-button" data-tab="my-orders">
                <i class="fas fa-truck"></i>
                <span>My Orders</span>
            </button>
            <button id="my-inventory-tab" class="tab-button" data-tab="my-inventory">
                <i class="fas fa-boxes"></i>
                <span>My Inventory</span>
            </button>
            <button id="my-earnings-tab" class="tab-button" data-tab="my-earnings">
                <i class="fas fa-dollar-sign"></i>
                <span>My Earnings</span>
            </button>
            <button id="reports-tab" class="tab-button" data-tab="reports">
                <i class="fas fa-chart-line"></i>
                <span>Reports</span>
            </button>
            <button id="users-tab" class="tab-button" data-tab="users" style="display: none;">
                <i class="fas fa-users"></i>
                <span>Users</span>
            </button>
        </nav>
    </div>

    <!-- Templates for different sections -->
    <!-- Login Template -->
    <template id="login-template">
        <div class="login-container">
            <div class="login-form">
                <h2>Login to Inventory Manager</h2>
                <form id="login-form">
                    <div class="form-group">
                        <label for="login-username">Username</label>
                        <input type="text" id="login-username" required autocomplete="username">
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" required autocomplete="current-password">
                    </div>
                    <button type="submit" class="primary-button">Login</button>
                </form>
                <div id="login-error" class="error-message" style="display: none;"></div>
                <div class="login-info">
                    <p><strong>Default Admin Account:</strong></p>
                    <p>Username: <code>admin</code></p>
                    <p>Password: <code>Admin123!</code></p>
                    <small>Please change the password after first login</small>
                </div>
            </div>
        </div>
    </template>

    <!-- Dashboard Template -->
    <template id="dashboard-template">
        <div class="dashboard-container">
            <h2>Dashboard</h2>
            <div class="dashboard-cards">
                <div class="card">
                    <h3>Products</h3>
                    <p id="product-count">0</p>
                </div>
                <div class="card">
                    <h3>Drivers</h3>
                    <p id="driver-count">0</p>
                </div>
                <div class="card">
                    <h3>Today's Sales</h3>
                    <p id="today-sales">$0.00</p>
                </div>
                <div class="card">
                    <h3>Total Inventory</h3>
                    <p id="total-inventory">0</p>
                </div>
            </div>
            <div class="recent-activity">
                <h3>Recent Activity</h3>
                <ul id="recent-activity-list">
                    <!-- Recent activities will be loaded here -->
                </ul>
            </div>
        </div>
    </template>

    <!-- Products Template -->
    <template id="products-template">
        <div class="products-container">
            <h2>Products</h2>
            <form id="add-product-form" class="action-form">
                <div class="form-group">
                    <label for="product-name">Product Name</label>
                    <input type="text" id="product-name" required>
                </div>
                <div class="form-group">
                    <label for="product-quantity">Initial Quantity</label>
                    <input type="number" id="product-quantity" min="0" value="0" required>
                </div>
                <button type="submit" class="primary-button">Add Product</button>
            </form>

            <div class="list-container">
                <h3>Current Products</h3>
                <div class="search-bar">
                    <input type="text" id="product-search" placeholder="Search products...">
                </div>
                <ul id="products-list" class="data-list">
                    <!-- Products will be loaded here -->
                </ul>
            </div>
        </div>
    </template>

    <!-- Drivers Template -->
    <template id="drivers-template">
        <div class="drivers-container">
            <h2>Drivers</h2>
            <form id="add-driver-form" class="action-form">
                <div class="form-group">
                    <label for="driver-name">Driver Name</label>
                    <input type="text" id="driver-name" required>
                </div>
                <div class="form-group">
                    <label for="driver-phone">Phone Number</label>
                    <input type="tel" id="driver-phone" required>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="create-user-account">
                        Create user account for this driver
                    </label>
                    <small style="display: block; margin-top: 0.5rem; color: #666;">
                        If checked, a login account will be created automatically with default password "Driver123!"
                    </small>
                </div>
                <button type="submit" class="primary-button">Add Driver</button>
            </form>

            <div class="list-container">
                <h3>Current Drivers</h3>
                <div class="search-bar">
                    <input type="text" id="driver-search" placeholder="Search drivers...">
                </div>
                <ul id="drivers-list" class="data-list">
                    <!-- Drivers will be loaded here -->
                </ul>
            </div>
        </div>
    </template>

    <!-- Assign Template -->
    <template id="assign-template">
        <div class="assign-container">
            <div class="assignments-header">
                <h2>Stock Management</h2>
                <div class="view-switcher">
                    <button id="show-assign-stock" class="secondary-button active">Assign Stock</button>
                    <button id="show-transfer-stock" class="secondary-button">Transfer Stock</button>
                </div>
            </div>

            <!-- Assign Stock Section -->
            <div id="assign-stock-section" class="section">
                <h3>Assign Products to Drivers</h3>
                <form id="assign-form" class="action-form">
                <div class="form-group">
                    <label for="assign-driver">Select Driver</label>
                    <select id="assign-driver" required>
                        <option value="">-- Select Driver --</option>
                        <!-- Drivers will be loaded here -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="assign-product">Select Product</label>
                    <select id="assign-product" required>
                        <option value="">-- Select Product --</option>
                        <!-- Products will be loaded here -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="assign-quantity">Quantity</label>
                    <input type="number" id="assign-quantity" min="1" required>
                </div>
                <button type="submit" class="primary-button">Assign Products</button>
            </form>
            </div>

            <!-- Transfer Stock Section -->
            <div id="transfer-stock-section" class="section" style="display: none;">
                <h3>Transfer/Collect Stock</h3>
                <form id="transfer-form" class="action-form">
                    <div class="form-group">
                        <label for="transfer-from-driver">From Driver</label>
                        <select id="transfer-from-driver" required>
                            <option value="">-- Select Source Driver --</option>
                            <!-- Drivers will be loaded here -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="transfer-product">Select Product</label>
                        <select id="transfer-product" required>
                            <option value="">-- Select Product --</option>
                            <!-- Products will be filtered by from-driver selection -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="transfer-to-driver">To Destination</label>
                        <select id="transfer-to-driver" required>
                            <option value="">-- Select Destination --</option>
                            <option value="main-inventory">📦 Main Inventory (Collect Stock)</option>
                            <!-- Other drivers will be loaded here -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="transfer-quantity">Quantity</label>
                        <input type="number" id="transfer-quantity" min="1" required>
                        <small id="available-quantity-display" class="quantity-info"></small>
                    </div>
                    <button type="submit" class="primary-button">Transfer Stock</button>
                </form>
            </div>

            <div class="history-section">
                <div class="history-tabs">
                    <button id="show-assignment-history" class="history-tab active">Assignment History</button>
                    <button id="show-transfer-history" class="history-tab">Transfer History</button>
                </div>

                <!-- Assignment History -->
                <div id="assignment-history-section" class="history-content">
                    <div class="driver-selector">
                        <label for="history-driver">Filter by Driver</label>
                        <select id="history-driver">
                            <option value="">All Drivers</option>
                            <!-- Drivers will be loaded here -->
                        </select>
                    </div>
                    <ul id="assignment-history-list" class="data-list">
                        <!-- Assignment history will be loaded here -->
                    </ul>
                </div>

                <!-- Transfer History -->
                <div id="transfer-history-section" class="history-content" style="display: none;">
                    <div class="driver-selector">
                        <label for="transfer-history-filter">Filter by Driver</label>
                        <select id="transfer-history-filter">
                            <option value="">All Transfers</option>
                            <!-- Drivers will be loaded here -->
                        </select>
                    </div>
                    <ul id="transfer-history-list" class="data-list">
                        <!-- Transfer history will be loaded here -->
                    </ul>
                </div>
            </div>
        </div>
    </template>

    <!-- Orders Template -->
    <template id="orders-template">
        <div class="orders-container">
            <div class="orders-header">
                <h2>Order Management</h2>
                <div class="view-switcher">
                    <button id="show-create-order" class="secondary-button active">Create Order</button>
                    <button id="show-manage-orders" class="secondary-button">Manage Orders</button>
                </div>
            </div>

            <!-- Create Order Section -->
            <div id="create-order-section" class="section">
                <h3>Create New Order</h3>
                <form id="order-form" class="action-form">
                    <div class="form-group">
                        <label for="order-driver">Select Driver</label>
                        <select id="order-driver" required>
                            <option value="">-- Select Driver --</option>
                            <!-- Drivers will be loaded here -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="customer-address">Customer Address</label>
                        <input type="text" id="customer-address" required>
                    </div>
                    <div class="form-group">
                        <label for="customer-description">Customer Description (Optional)</label>
                        <input type="text" id="customer-description">
                    </div>

                    <h4>Line Items</h4>
                    <div id="line-items-container">
                        <div class="line-item" data-index="0">
                            <div class="form-group">
                                <label for="line-item-product-0">Product</label>
                                <select class="line-item-product" id="line-item-product-0" required>
                                    <option value="">-- Select Product --</option>
                                    <!-- Products will be loaded here -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="line-item-category-0">Quantity Type</label>
                                <select class="line-item-category" id="line-item-category-0" required>
                                    <option value="">-- Select Type --</option>
                                    <option value="Q">Q</option>
                                    <option value="3.5">3.5</option>
                                    <option value="H">H</option>
                                    <option value="Oz">Oz</option>
                                    <option value="Quantity by pcs">Quantity by pcs</option>
                                </select>
                            </div>
                            <div class="form-group" id="custom-quantity-group-0" style="display: none;">
                                <label for="line-item-custom-quantity-0">Custom Quantity</label>
                                <input type="number" class="line-item-custom-quantity" id="line-item-custom-quantity-0" min="1">
                            </div>
                            <div class="form-group checkbox">
                                <label for="line-item-gift-0">
                                    <input type="checkbox" class="line-item-gift" id="line-item-gift-0">
                                    Free Gift
                                </label>
                            </div>
                            <button type="button" class="remove-line-item danger-button" style="display: none;">Remove</button>
                        </div>
                    </div>
                    
                    <button type="button" id="add-line-item" class="secondary-button">Add Another Item</button>
                    
                    
                    <div class="form-group total-amount">
                        <label for="total-amount">Total Amount</label>
                        <input type="number" id="total-amount" min="0" step="0.01" required>
                    </div>
                    
                    <button type="submit" class="primary-button">Create Order</button>
                </form>
            </div>

            <!-- Manage Orders Section -->
            <div id="manage-orders-section" class="section" style="display: none;">
                <h3>Manage Orders</h3>
                <div class="orders-filters">
                    <div class="form-group">
                        <label for="order-status-filter">Filter by Status</label>
                        <select id="order-status-filter">
                            <option value="">All Orders</option>
                            <option value="pending">Pending</option>
                            <option value="completed">Completed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                </div>
                <div class="orders-list">
                    <ul id="orders-list" class="data-list">
                        <!-- Orders will be loaded here -->
                    </ul>
                </div>
            </div>
        </div>
    </template>

    <!-- Reports Template -->
    <template id="reports-template">
        <div class="reports-container">
            <h2>Reports</h2>
            
            <div class="report-selector">
                <button class="report-tab active" data-report="sales">Sales Reports</button>
                <button class="report-tab" data-report="inventory">Inventory Reports</button>
            </div>
            
            <div id="sales-report" class="report-section active">
                <h3>Sales Reports</h3>
                <div class="report-filters">
                    <div class="form-group">
                        <label for="report-driver">Driver</label>
                        <select id="report-driver">
                            <option value="">All Drivers</option>
                            <!-- Drivers will be loaded here -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="report-period">Period</label>
                        <select id="report-period">
                            <option value="day">Day</option>
                            <option value="week">Week</option>
                            <option value="month">Month</option>
                            <option value="year">Year</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="report-date">Date</label>
                        <input type="date" id="report-date">
                    </div>
                    <button id="generate-sales-report" class="secondary-button">Generate Report</button>
                </div>
                <div id="sales-report-results" class="report-results">
                    <!-- Sales report results will be loaded here -->
                </div>
            </div>
            
            <div id="inventory-report" class="report-section">
                <h3>Inventory Reports</h3>
                <div class="report-filters">
                    <div class="form-group">
                        <label for="inventory-driver">Driver</label>
                        <select id="inventory-driver">
                            <option value="">All Drivers</option>
                            <!-- Drivers will be loaded here -->
                        </select>
                    </div>
                    <button id="generate-inventory-report" class="secondary-button">Generate Report</button>
                </div>
                <div id="inventory-report-results" class="report-results">
                    <!-- Inventory report results will be loaded here -->
                </div>
            </div>
        </div>
    </template>

    <!-- User Management Template (Admin Only) -->
    <template id="users-template">
        <div class="users-container">
            <h2>User Management</h2>
            <form id="add-user-form" class="action-form">
                <div class="form-group">
                    <label for="user-username">Username</label>
                    <input type="text" id="user-username" required>
                </div>
                <div class="form-group">
                    <label for="user-password">Password</label>
                    <input type="password" id="user-password" required>
                </div>
                <div class="form-group">
                    <label for="user-name">Full Name</label>
                    <input type="text" id="user-name" required>
                </div>
                <div class="form-group">
                    <label for="user-role">Role</label>
                    <select id="user-role" required>
                        <option value="">-- Select Role --</option>
                        <option value="admin">Admin</option>
                        <option value="sales_rep">Sales Rep</option>
                        <option value="driver">Driver</option>
                    </select>
                </div>
                <div class="form-group" id="user-driver-group" style="display: none;">
                    <label for="user-driver">Link to Driver</label>
                    <select id="user-driver">
                        <option value="">-- Select Driver --</option>
                        <!-- Drivers will be loaded here -->
                    </select>
                    <div style="margin-top: 1rem;">
                        <label>
                            <input type="checkbox" id="create-driver-profile">
                            Create new driver profile if no driver selected
                        </label>
                    </div>
                </div>
                <div class="form-group" id="user-phone-group" style="display: none;">
                    <label for="user-phone">Phone Number (for driver profile)</label>
                    <input type="tel" id="user-phone" placeholder="Enter phone number for driver profile">
                </div>
                <button type="submit" class="primary-button">Create User</button>
            </form>

            <div class="list-container">
                <h3>System Users</h3>
                <ul id="users-list" class="data-list">
                    <!-- Users will be loaded here -->
                </ul>
            </div>
        </div>
    </template>

    <!-- My Orders Template (Driver View) -->
    <template id="my-orders-template">
        <div class="my-orders-container">
            <h2>My Orders</h2>
            
            <div class="orders-filters">
                <div class="form-group">
                    <label for="my-order-status-filter">Filter by Status</label>
                    <select id="my-order-status-filter">
                        <option value="">All Orders</option>
                        <option value="pending">Pending</option>
                        <option value="completed">Completed</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                </div>
            </div>
            
            <div class="my-orders-list">
                <ul id="my-orders-list" class="data-list">
                    <!-- Orders will be loaded here -->
                </ul>
            </div>
        </div>
    </template>

    <!-- My Inventory Template (Driver View) -->
    <template id="my-inventory-template">
        <div class="my-inventory-container">
            <h2>My Inventory</h2>
            
            <div class="inventory-filters">
                <div class="form-group">
                    <label for="inventory-filter">Filter by Stock Level</label>
                    <select id="inventory-filter">
                        <option value="">All Items</option>
                        <option value="normal">Normal Stock</option>
                        <option value="warning">Low Stock</option>
                        <option value="critical">Out of Stock</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="inventory-sort">Sort by</label>
                    <select id="inventory-sort">
                        <option value="name">Product Name</option>
                        <option value="quantity-asc">Quantity (Low to High)</option>
                        <option value="quantity-desc">Quantity (High to Low)</option>
                        <option value="alert">Alert Level</option>
                    </select>
                </div>
            </div>
            
            <div class="inventory-summary">
                <div class="summary-cards">
                    <div class="summary-card normal">
                        <div class="summary-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="summary-content">
                            <div class="summary-number" id="normal-stock-count">0</div>
                            <div class="summary-label">Normal Stock</div>
                        </div>
                    </div>
                    <div class="summary-card warning">
                        <div class="summary-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="summary-content">
                            <div class="summary-number" id="low-stock-count">0</div>
                            <div class="summary-label">Low Stock</div>
                        </div>
                    </div>
                    <div class="summary-card critical">
                        <div class="summary-icon">
                            <i class="fas fa-times-circle"></i>
                        </div>
                        <div class="summary-content">
                            <div class="summary-number" id="out-stock-count">0</div>
                            <div class="summary-label">Out of Stock</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="inventory-list">
                <div id="inventory-items-container" class="inventory-items">
                    <!-- Inventory items will be loaded here -->
                </div>
                <div id="no-inventory-message" class="no-data-message" style="display: none;">
                    <i class="fas fa-box-open"></i>
                    <p>No inventory items found</p>
                    <small>Items will appear here when you have products assigned to you</small>
                </div>
            </div>
        </div>
    </template>

    <!-- My Earnings Template (Driver View) -->
    <template id="my-earnings-template">
        <div class="my-earnings-container">
            <h2>My Earnings</h2>
            
            <div class="earnings-filters">
                <div class="form-group">
                    <label for="earnings-period">Period</label>
                    <select id="earnings-period">
                        <option value="day">Today</option>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="earnings-date">Date</label>
                    <input type="date" id="earnings-date">
                </div>
                <button id="refresh-earnings" class="secondary-button">Refresh</button>
            </div>

            <div class="earnings-summary">
                <div class="summary-cards">
                    <div class="summary-card total-sales">
                        <div class="summary-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="summary-content">
                            <div class="summary-number" id="total-sales-amount">$0.00</div>
                            <div class="summary-label">Total Sales</div>
                            <div class="summary-detail" id="total-sales-detail">0 orders</div>
                        </div>
                    </div>
                    <div class="summary-card driver-salary">
                        <div class="summary-icon">
                            <i class="fas fa-truck"></i>
                        </div>
                        <div class="summary-content">
                            <div class="summary-number" id="driver-salary-amount">$0.00</div>
                            <div class="summary-label">My Earnings</div>
                            <div class="summary-detail" id="driver-salary-detail">0 deliveries × $30</div>
                        </div>
                    </div>
                    <div class="summary-card boss-collection">
                        <div class="summary-icon">
                            <i class="fas fa-hand-holding-usd"></i>
                        </div>
                        <div class="summary-content">
                            <div class="summary-number" id="boss-collection-amount">$0.00</div>
                            <div class="summary-label">To Boss</div>
                            <div class="summary-detail" id="boss-collection-detail">Sales - Earnings</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="earnings-breakdown">
                <h3>Delivery Details</h3>
                <div class="earnings-tabs">
                    <button class="earnings-tab active" data-filter="delivery">Paid Deliveries</button>
                    <button class="earnings-tab" data-filter="pickup">Free Pickups</button>
                    <button class="earnings-tab" data-filter="all">All Orders</button>
                </div>
                
                <div class="earnings-list">
                    <div id="earnings-list-container" class="earnings-items">
                        <!-- Earnings items will be loaded here -->
                    </div>
                    <div id="no-earnings-message" class="no-data-message" style="display: none;">
                        <i class="fas fa-inbox"></i>
                        <p>No completed orders found</p>
                        <small>Orders will appear here when you complete deliveries</small>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Firebase Configuration (ES Modules) -->
    <script type="module" src="js/firebase-config.js"></script>
    
    <!-- Application Scripts (ES Modules) -->
    <script type="module" src="js/database.js"></script>
    <script type="module" src="js/app.js"></script>
    <script type="module" src="js/products.js"></script>
    <script type="module" src="js/drivers.js"></script>
    <script type="module" src="js/assignments.js"></script>
    <script type="module" src="js/orders.js"></script>
    <script type="module" src="js/my-orders.js"></script>
    <script type="module" src="js/my-inventory.js"></script>
    <script type="module" src="js/my-earnings.js"></script>
    <script type="module" src="js/reports.js"></script>
    <script type="module" src="js/users.js"></script>
    <script type="module" src="js/auth.js"></script>
    <script>
        // Register the service worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js')
                .then(registration => {
                    console.log('Service Worker registered with scope:', registration.scope);
                })
                .catch(error => {
                    console.error('Service Worker registration failed:', error);
                });
        }
    </script>
</body>
</html>
